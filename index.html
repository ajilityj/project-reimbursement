<!DOCTYPE html>
<html lang="en">
  <head> </head>
  <body>
    <script>
      (function() {
        const set1 = [
          {
            cityCost: "low",
            startDate: "9/1/15",
            endDate: "9/3/15"
          }
        ];
        const set2 = [
          {
            cityCost: "low",
            startDate: "9/1/15",
            endDate: "9/1/15"
          },
          {
            cityCost: "high",
            startDate: "9/2/15",
            endDate: "9/6/15"
          },
          {
            cityCost: "low",
            startDate: "9/6/15",
            endDate: "9/8/15"
          }
        ];
        const set3 = [
          {
            cityCost: "low",
            startDate: "9/1/15",
            endDate: "9/3/15"
          },
          {
            cityCost: "high",
            startDate: "9/5/15",
            endDate: "9/7/15"
          },
          {
            cityCost: "high",
            startDate: "9/8/15",
            endDate: "9/8/15"
          }
        ];
        const set4 = [
          {
            cityCost: "low",
            startDate: "9/1/15",
            endDate: "9/1/15"
          },
          {
            cityCost: "low",
            startDate: "9/1/15",
            endDate: "9/1/15"
          },
          {
            cityCost: "high",
            startDate: "9/2/15",
            endDate: "9/2/15"
          },
          {
            cityCost: "high",
            startDate: "9/2/15",
            endDate: "9/3/15"
          }
        ];

        function calculateReimbursement(set) {
          // determine number of projects in set
          const numProjects = set.length;

          // no projects exist in the set
          if (!numProjects) return 0;

          // set inital dates to start/end date of first project in set
          let setStartDate = set[0].startDate;
          let setEndDate = set[0].endDate;

          // only 1 project exists in the set
          if (numProjects === 1) {
            // set project rates
            const travelDayRate = set[0].cityCost === "low" ? 45 : 55;
            const fullDayRate = set[0].cityCost === "low" ? 75 : 85;

            // return single-day travel rate, if start & end dates match
            if (setStartDate === setEndDate) return travelDayRate;

            // determine num of full days, subtracting 1 for end date
            const numOfFullDays = countNumOfDays(setStartDate, setEndDate) - 1;

            // return single-project reimbursement
            return travelDayRate * 2 + fullDayRate * numOfFullDays;
          }

          // find set's start date & end date
          for (const project of set) {
            setStartDate = startDateComparison(project.startDate, setStartDate);
            setEndDate = endDateComparison(project.endDate, setEndDate);
          }
          console.log(`setStartDate: ${setStartDate}`);
          console.log(`setEndDate: ${setEndDate}`);

          // determine num of days in set, adding 1 for start date
          console.log(
            `days in set: ${countNumOfDays(setStartDate, setEndDate) + 1}`
          );

          let reimbursementMatrix = [];

          // for each project in the set
          for (let i = 0; i < numProjects; i++) {
            let reimbursement = [];

            // determine num of days in project, adding 1 for start date
            const numProjectDays =
              countNumOfDays(set[i].startDate, set[i].endDate) + 1;

            // set project rates
            const travelDayRate = set[i].cityCost === "low" ? 45 : 55;
            const fullDayRate = set[i].cityCost === "low" ? 75 : 85;

            // for each day in the project
            for (let j = 0; j < numProjectDays; j++) {
              if (
                (set[i].startDate === setStartDate && j === 0) ||
                (set[i].endDate === setEndDate && j === numProjectDays - 1)
              ) {
                // add travel rate
                reimbursement[j] = travelDayRate;
              } else {
                // add full day rate
                reimbursement[j] = fullDayRate;
              }
            }
            console.log(reimbursement);
            reimbursementMatrix[i] = reimbursement;
          }

          return reimbursementMatrix;
        }

        function countNumOfDays(date1, date2) {
          // calculate the number of milliseconds in one day
          const oneDay = 24 * 60 * 60 * 1000;

          // convert dates to milliseconds
          date1 = new Date(date1).getTime();
          date2 = new Date(date2).getTime();

          // calculate the date difference in milliseconds
          const dateDifference = Math.abs(date1 - date2);

          // convert dateDifference milliseconds back to days
          const numOfDays = Math.round(dateDifference / oneDay);

          // return number of days between dates
          return numOfDays;
        }

        function startDateComparison(date1, date2) {
          // convert dates to milliseconds
          const d1 = new Date(date1).getTime();
          const d2 = new Date(date2).getTime();

          // return earlier date
          return d1 < d2 ? date1 : date2;
        }

        function endDateComparison(date1, date2) {
          // convert dates to milliseconds
          const d1 = new Date(date1).getTime();
          const d2 = new Date(date2).getTime();

          // return later date
          return d1 > d2 ? date1 : date2;
        }

        console.log("-----");
        console.log(`Set 1: ${calculateReimbursement(set1)}`);
        console.log("-----");
        console.log(`Set 2: ${calculateReimbursement(set2)}`);
        // console.log('-----');
        // console.log(`Set 3: ${calculateReimbursement(set3)}`);
        // console.log('-----');
        // console.log(`Set 4: ${calculateReimbursement(set4)}`);
      })();
    </script>
  </body>
</html>
